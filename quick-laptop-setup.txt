#!/bin/bash
echo "ðŸš€ CLAUDE WORKSPACE - LAPTOP SETUP VELOCE"
echo "========================================="

# Cleanup se esiste
if [[ -d ~/claude-workspace ]] || [[ -d ~/.claude-access ]]; then
    echo "ðŸ§¹ Cleanup installazione precedente..."
    rm -rf ~/.claude-access/ ~/claude-workspace/ 2>/dev/null
    sed -i '/# Claude Workspace Commands/,/^$/d' ~/.bashrc 2>/dev/null
fi

# Install prerequisiti
sudo apt update && sudo apt install -y git inotify-tools

# Clone con HTTPS
echo "ðŸ“¥ Clonazione repository..."
cd ~
git clone https://github.com/null-runner/claude-workspace.git

# Setup sistema controllo
mkdir -p ~/.claude-access/keys
ssh-keygen -t ed25519 -f ~/.claude-access/keys/claude_deploy -N "" -C "claude-workspace-$(hostname)"

echo ""
echo "ðŸ“‹ AGGIUNGI QUESTA DEPLOY KEY SU GITHUB:"
echo "   URL: https://github.com/null-runner/claude-workspace/settings/keys"
echo "   Nome: Claude-Laptop-$(hostname)-$(date +%Y%m%d)"
echo "   âœ… Allow write access"
echo ""
cat ~/.claude-access/keys/claude_deploy.pub
echo ""
read -p "Premi ENTER dopo aver aggiunto la deploy key..."

# Setup alias
cat >> ~/.bashrc << 'EOF'

# Claude Workspace Commands
alias claude-enable="~/claude-workspace/scripts/claude-enable.sh"
alias claude-disable="~/claude-workspace/scripts/claude-disable.sh"
alias claude-status="~/claude-workspace/scripts/claude-status.sh"
alias claude-sync="~/claude-workspace/scripts/sync-now.sh"
alias claude-log="tail -f ~/claude-workspace/logs/sync.log"
EOF

chmod +x ~/claude-workspace/scripts/*.sh

echo ""
echo "âœ… SETUP COMPLETATO!"
echo "Esegui: source ~/.bashrc && claude-enable"